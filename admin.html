<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script>
const firestore = firebase.firestore();


    // Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© script ÙÙŠ admin.html

// Load doctors list
async function loadDoctorsNew() {
    try {
        const doctorsSnap = await firestore.collection('doctors').get();
        const listDiv = document.getElementById('doctorsListNew');
        
        if (doctorsSnap.empty) {
            listDiv.innerHTML = '<p class="text-gray-500 text-center py-4">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø·Ø¨Ø§Ø¡</p>';
            return;
        }

        // Get specialties for filter
        const specialties = new Set();
        
        listDiv.innerHTML = '';
        doctorsSnap.forEach(doc => {
            const doctor = { id: doc.id, ...doc.data() };
            specialties.add(doctor.specialty);
            
            const statusColor = doctor.workStatus === 'Ù†Ø´Ø·' ? 'text-green-600' : 
                               doctor.workStatus === 'Ù…Ø¹Ù„Ù‚' ? 'text-red-600' : 'text-yellow-600';
            
            listDiv.innerHTML += `
                <div class="doctor-item flex items-center justify-between p-4 bg-gray-50 rounded-lg" 
                     data-specialty="${doctor.specialty}" data-status="${doctor.workStatus}">
                    <div class="flex-1">
                        <div class="flex items-center gap-4 mb-2">
                            <h4 class="text-lg font-bold text-gray-800">${doctor.name}</h4>
                            <span class="text-sm text-gray-600">Ø±Ù‚Ù…: ${doctor.employeeNumber}</span>
                            <span class="${statusColor} font-bold text-sm">${doctor.workStatus}</span>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-sm text-gray-600">
                            <p><strong>Ø§Ù„ØªØ®ØµØµ:</strong> ${doctor.specialty}</p>
                            <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${doctor.phone}</p>
                            <p><strong>Ø§Ù„Ø´ÙŠÙØª:</strong> ${doctor.shift}</p>
                            <p><strong>Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª:</strong> ${doctor.regularLeaveBalance || 0} / ${doctor.casualLeaveBalance || 0}</p>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="viewDoctorReport('${doctor.id}')" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">ØªÙ‚Ø±ÙŠØ±</button>
                        <button onclick="editDoctorNew('${doctor.id}')" class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button onclick="deleteDoctorNew('${doctor.id}')" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Ø­Ø°Ù</button>
                    </div>
                </div>
            `;
        });

        // Update specialty filter
        const filterSelect = document.getElementById('filterSpecialty');
        filterSelect.innerHTML = '<option value="">ÙƒÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª</option>';
        specialties.forEach(spec => {
            filterSelect.innerHTML += `<option value="${spec}">${spec}</option>`;
        });

        // Update attendance doctor select
        const attendanceSelect = document.getElementById('attendanceDoctor');
        attendanceSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø¨ÙŠØ¨</option>';
        doctorsSnap.forEach(doc => {
            const doctor = doc.data();
            attendanceSelect.innerHTML += `<option value="${doc.id}">${doctor.name} - ${doctor.employeeNumber}</option>`;
        });

    } catch (error) {
        console.error('Error loading doctors:', error);
    }
}

function searchDoctors() {
    const search = document.getElementById('searchDoctors').value.toLowerCase();
    const items = document.querySelectorAll('.doctor-item');
    
    items.forEach(item => {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(search) ? 'flex' : 'none';
    });
}

function filterDoctors() {
    const specialty = document.getElementById('filterSpecialty').value;
    const status = document.getElementById('filterStatus').value;
    const items = document.querySelectorAll('.doctor-item');
    
    items.forEach(item => {
        const itemSpecialty = item.dataset.specialty;
        const itemStatus = item.dataset.status;
        
        const matchSpecialty = !specialty || itemSpecialty === specialty;
        const matchStatus = !status || itemStatus === status;
        
        item.style.display = (matchSpecialty && matchStatus) ? 'flex' : 'none';
    });
}

function showAddDoctorNew() {
    document.getElementById('doctorModalTitleNew').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø·Ø¨ÙŠØ¨ Ø¬Ø¯ÙŠØ¯';
    document.getElementById('editDoctorIdNew').value = '';
    document.getElementById('doctorEmployeeNumber').value = '';
    document.getElementById('doctorNameNew').value = '';
    document.getElementById('doctorPhoneNew').value = '';
    document.getElementById('doctorNationalId').value = '';
    document.getElementById('doctorSpecialtyNew').value = '';
    document.getElementById('doctorClinicNew').value = '';
    document.getElementById('doctorWorkStatus').value = 'Ù†Ø´Ø·';
    document.getElementById('doctorShift').value = 'ØµØ¨Ø§Ø­ÙŠ';
    document.getElementById('doctorRegularLeave').value = '21';
    document.getElementById('doctorCasualLeave').value = '7';
    document.getElementById('doctorEmail').value = '';
    document.getElementById('doctorPassword').value = '';
    document.getElementById('doctorNotesNew').value = '';
    document.querySelectorAll('.doctor-day-checkbox-new').forEach(cb => cb.checked = false);
    document.getElementById('passwordSection').style.display = 'block';
    
    // Load clinics
    loadClinicsForDoctor();
    
    document.getElementById('doctorModalNew').classList.remove('hidden');
}

async function editDoctorNew(id) {
    try {
        const doc = await firestore.collection('doctors').doc(id).get();
        const doctor = doc.data();
        
        document.getElementById('doctorModalTitleNew').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ¨';
        document.getElementById('editDoctorIdNew').value = id;
        document.getElementById('doctorEmployeeNumber').value = doctor.employeeNumber;
        document.getElementById('doctorNameNew').value = doctor.name;
        document.getElementById('doctorPhoneNew').value = doctor.phone;
        document.getElementById('doctorNationalId').value = doctor.nationalId;
        document.getElementById('doctorSpecialtyNew').value = doctor.specialty;
        document.getElementById('doctorClinicNew').value = doctor.clinicId;
        document.getElementById('doctorWorkStatus').value = doctor.workStatus;
        document.getElementById('doctorShift').value = doctor.shift;
        document.getElementById('doctorRegularLeave').value = doctor.regularLeaveBalance;
        document.getElementById('doctorCasualLeave').value = doctor.casualLeaveBalance;
        document.getElementById('doctorEmail').value = doctor.email;
        document.getElementById('doctorNotesNew').value = doctor.notes || '';
        
        // Work days
        const workDays = doctor.workDays || [];
        document.querySelectorAll('.doctor-day-checkbox-new').forEach(cb => {
            cb.checked = workDays.includes(cb.value);
        });
        
        // Hide password section when editing
        document.getElementById('passwordSection').style.display = 'none';
        
        await loadClinicsForDoctor();
        document.getElementById('doctorModalNew').classList.remove('hidden');
    } catch (error) {
        console.error('Error editing doctor:', error);
        alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    }
}

async function loadClinicsForDoctor() {
    const select = document.getElementById('doctorClinicNew');
    const clinicsSnap = await db.ref('clinics').once('value');
    const clinics = clinicsSnap.val() || {};
    
    select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</option>';
    Object.keys(clinics).forEach(id => {
        select.innerHTML += `<option value="${id}">${clinics[id].name}</option>`;
    });
}

async function saveDoctorNew() {
    const id = document.getElementById('editDoctorIdNew').value;
    const employeeNumber = document.getElementById('doctorEmployeeNumber').value;
    const name = document.getElementById('doctorNameNew').value;
    const phone = document.getElementById('doctorPhoneNew').value;
    const nationalId = document.getElementById('doctorNationalId').value;
    const specialty = document.getElementById('doctorSpecialtyNew').value;
    const clinicId = document.getElementById('doctorClinicNew').value;
    const workStatus = document.getElementById('doctorWorkStatus').value;
    const shift = document.getElementById('doctorShift').value;
    const regularLeave = parseInt(document.getElementById('doctorRegularLeave').value);
    const casualLeave = parseInt(document.getElementById('doctorCasualLeave').value);
    const email = document.getElementById('doctorEmail').value;
    const password = document.getElementById('doctorPassword').value;
    const notes = document.getElementById('doctorNotesNew').value;
    
    const workDays = Array.from(document.querySelectorAll('.doctor-day-checkbox-new:checked'))
        .map(cb => cb.value);

    if (!employeeNumber || !name || !phone || !specialty || !email) {
        alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
        return;
    }

    try {
        const doctorData = {
            employeeNumber,
            name,
            phone,
            nationalId,
            specialty,
            clinicId,
            workDays,
            workStatus,
            shift,
            regularLeaveBalance: regularLeave,
            casualLeaveBalance: casualLeave,
            absenceDays: 0,
            notes,
            email,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        if (id) {
            // Update existing
            await firestore.collection('doctors').doc(id).update(doctorData);
            alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ¨');
        } else {
            // Create new
            if (!password) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±');
                return;
            }

            // Create Firebase Auth user
            const userCredential = await auth.createUserWithEmailAndPassword(email, password);
            
            doctorData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            await firestore.collection('doctors').add(doctorData);
            
            alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø¨Ù†Ø¬Ø§Ø­');
        }

        closeDoctorModalNew();
        loadDoctorsNew();
    } catch (error) {
        console.error('Error saving doctor:', error);
        if (error.code === 'auth/email-already-in-use') {
            alert('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„');
        } else {
            alert('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
        }
    }
}

async function deleteDoctorNew(id) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø¨ÙŠØ¨ØŸ')) return;

    try {
        await firestore.collection('doctors').doc(id).delete();
        alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø¨ÙŠØ¨');
        loadDoctorsNew();
    } catch (error) {
        console.error('Error deleting doctor:', error);
        alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù');
    }
}

function closeDoctorModalNew() {
    document.getElementById('doctorModalNew').classList.add('hidden');
}

// Attendance Management
async function saveAttendance() {
    const doctorId = document.getElementById('attendanceDoctor').value;
    const date = document.getElementById('attendanceDate').value;
    const checkIn = document.getElementById('checkInTime').value;
    const checkOut = document.getElementById('checkOutTime').value;
    const status = document.getElementById('attendanceStatus').value;
    const shift = document.getElementById('attendanceShift').value;
    const notes = document.getElementById('attendanceNotes').value;

    if (!doctorId || !date) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø¨ÙŠØ¨ ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®');
        return;
    }

    try {
        const month = date.substring(0, 7); // YYYY-MM
        
        const attendanceData = {
            doctorId,
            date,
            month,
            checkIn: checkIn ? firebase.firestore.Timestamp.fromDate(new Date(`${date}T${checkIn}`)) : null,
            checkOut: checkOut ? firebase.firestore.Timestamp.fromDate(new Date(`${date}T${checkOut}`)) : null,
            status,
            shift,
            notes,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        await firestore.collection('attendance').add(attendanceData);
        alert('ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±');
        
        // Clear form
        document.getElementById('attendanceDate').value = '';
        document.getElementById('checkInTime').value = '';
        document.getElementById('checkOutTime').value = '';
        document.getElementById('attendanceNotes').value = '';
    } catch (error) {
        console.error('Error saving attendance:', error);
        alert('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    }
}

async function uploadAttendanceExcel() {
    const fileInput = document.getElementById('excelFile');
    const file = fileInput.files[0];
    
    if (!file) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù');
        return;
    }

    alert('Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØªØªØ·Ù„Ø¨ Ù…ÙƒØªØ¨Ø© Ù„Ù‚Ø±Ø§Ø¡Ø© Excel. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… SheetJS (xlsx) Ù„ØªÙ†ÙÙŠØ°Ù‡Ø§.');
    // Implementation would require xlsx library
}

// Requests Management
let currentAdminFilter = 'all';
let currentRequestId = null;

async function loadAdminRequests() {
    try {
        const requestsSnap = await firestore.collection('requests')
            .orderBy('submittedAt', 'desc')
            .get();

        const listDiv = document.getElementById('adminRequestsList');
        
        // Count by status
        let countAll = 0, countPending = 0, countApproved = 0, countRejected = 0;
        
        if (requestsSnap.empty) {
            listDiv.innerHTML = '<p class="text-gray-500 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</p>';
        } else {
            listDiv.innerHTML = '';
            requestsSnap.forEach(doc => {
                const req = { id: doc.id, ...doc.data() };
                countAll++;
                
                if (req.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©') countPending++;
                else if (req.status === 'Ù…ÙˆØ§ÙÙ‚') countApproved++;
                else if (req.status === 'Ù…Ø±ÙÙˆØ¶') countRejected++;
                
                // Filter
                if (currentAdminFilter !== 'all') {
                    const filterMap = { 'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', 'approved': 'Ù…ÙˆØ§ÙÙ‚', 'rejected': 'Ù…Ø±ÙÙˆØ¶' };
                    if (req.status !== filterMap[currentAdminFilter]) return;
                }
                
                const date = req.submittedAt ? new Date(req.submittedAt.toDate()).toLocaleDateString('ar-EG') : '';
                
                let statusBadge = '';
                if (req.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©') {
                    statusBadge = '<span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-bold">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© â³</span>';
                } else if (req.status === 'Ù…ÙˆØ§ÙÙ‚') {
                    statusBadge = '<span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-bold">Ù…ÙˆØ§ÙÙ‚ âœ…</span>';
                } else {
                    statusBadge = '<span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-bold">Ù…Ø±ÙÙˆØ¶ âŒ</span>';
                }

                const actionBtn = req.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' ? 
                    `<button onclick="openRequestReview('${req.id}')" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Ù…Ø±Ø§Ø¬Ø¹Ø©</button>` : 
                    `<button onclick="viewRequestDetails('${req.id}')" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">Ø¹Ø±Ø¶</button>`;

                listDiv.innerHTML += `
                    <div class="border rounded-lg p-4">
                        <div class="flex items-center justify-between mb-2">
                            <div>
                                <h4 class="text-lg font-bold text-gray-800">${req.doctorName}</h4>
                                <p class="text-sm text-gray-600">${req.type}</p>
                            </div>
                            ${statusBadge}
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-sm text-gray-600 mb-2">
                            <p><strong>Ù…Ù†:</strong> ${req.fromDate}</p>
                            <p><strong>Ø¥Ù„Ù‰:</strong> ${req.toDate}</p>
                            <p><strong>Ø§Ù„Ø£ÙŠØ§Ù…:</strong> ${req.days || 0}</p>
                            <p><strong>Ø§Ù„Ù‚Ø§Ø¦Ù… Ø¨Ø§Ù„Ø¹Ù…Ù„:</strong> ${req.replacement || '-'}</p>
                        </div>
                        ${req.notes ? `<p class="text-sm text-gray-600 mb-2"><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${req.notes}</p>` : ''}
                        <div class="flex items-center justify-between mt-3">
                            <p class="text-xs text-gray-500">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…: ${date}</p>
                            ${actionBtn}
                        </div>
                    </div>
                `;
            });
        }

        // Update counts
        document.getElementById('countAll').textContent = countAll;
        document.getElementById('countPending').textContent = countPending;
        document.getElementById('countApproved').textContent = countApproved;
        document.getElementById('countRejected').textContent = countRejected;
    } catch (error) {
        console.error('Error loading requests:', error);
    }
}

function filterAdminRequests(filter) {
    currentAdminFilter = filter;
    
    // Update button styles
    document.querySelectorAll('.admin-filter-btn').forEach(btn => {
        btn.classList.remove('bg-blue-600', 'text-white', 'bg-gray-200');
        btn.classList.add('bg-gray-200');
    });
    event.target.classList.remove('bg-gray-200');
    event.target.classList.add('bg-blue-600', 'text-white');
    
    loadAdminRequests();
}

async function openRequestReview(id) {
    currentRequestId = id;
    
    try {
        const doc = await firestore.collection('requests').doc(id).get();
        const req = doc.data();
        
        const content = document.getElementById('requestReviewContent');
        content.innerHTML = `
            <div class="bg-gray-50 p-4 rounded-lg space-y-2">
                <p><strong>Ø§Ù„Ø·Ø¨ÙŠØ¨:</strong> ${req.doctorName}</p>
                <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨:</strong> ${req.type}</p>
                <p><strong>Ù…Ù†:</strong> ${req.fromDate} <strong>Ø¥Ù„Ù‰:</strong> ${req.toDate}</p>
                <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…:</strong> ${req.days}</p>
                <p><strong>Ø§Ù„Ù‚Ø§Ø¦Ù… Ø¨Ø§Ù„Ø¹Ù…Ù„:</strong> ${req.replacement || '-'}</p>
                ${req.notes ? `<p><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ¨:</strong> ${req.notes}</p>` : ''}
            </div>
        `;
        
        document.getElementById('adminResponseText').value = '';
        document.getElementById('requestReviewModal').classList.remove('hidden');
    } catch (error) {
        console.error('Error loading request:', error);
    }
}

async function reviewRequest(action) {
    const response = document.getElementById('adminResponseText').value;
    
    if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ${action === 'approve' ? 'Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©' : 'Ø§Ù„Ø±ÙØ¶'}ØŸ`)) return;

    try {
        const doc = await firestore.collection('requests').doc(currentRequestId).get();
        const req = doc.data();
        
        const updateData = {
            status: action === 'approve' ? 'Ù…ÙˆØ§ÙÙ‚' : 'Ù…Ø±ÙÙˆØ¶',
            adminResponse: response,
            reviewedAt: firebase.firestore.FieldValue.serverTimestamp(),
            reviewedBy: currentUser.email
        };
        
        await firestore.collection('requests').doc(currentRequestId).update(updateData);
        
        // If approved, deduct from leave balance
        if (action === 'approve') {
            const doctorDoc = await firestore.collection('doctors')
                .where('name', '==', req.doctorName)
                .get();
            
            if (!doctorDoc.empty) {
                const doctorId = doctorDoc.docs[0].id;
                const doctor = doctorDoc.docs[0].data();
                
                if (req.type === 'Ø¥Ø¬Ø§Ø²Ø© Ø§Ø¹ØªÙŠØ§Ø¯ÙŠØ©') {
                    await firestore.collection('doctors').doc(doctorId).update({
                        regularLeaveBalance: doctor.regularLeaveBalance - req.days
                    });
                } else if (req.type === 'Ø¥Ø¬Ø§Ø²Ø© Ø¹Ø§Ø±Ø¶Ø©') {
                    await firestore.collection('doctors').doc(doctorId).update({
                        casualLeaveBalance: doctor.casualLeaveBalance - req.days
                    });
                }
            }
        }
        
        alert('ØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨');
        closeRequestReviewModal();
        loadAdminRequests();
    } catch (error) {
        console.error('Error reviewing request:', error);
        alert('Ø®Ø·Ø£ ÙÙŠ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨');
    }
}

function closeRequestReviewModal() {
    document.getElementById('requestReviewModal').classList.add('hidden');
}

// Complaints Management
let currentComplaintFilter = 'all';
let currentComplaintId = null;

async function loadComplaints() {
    try {
        let query = firestore.collection('complaints').orderBy('submittedAt', 'desc');
        
        const complaintsSnap = await query.get();
        const listDiv = document.getElementById('complaintsList');
        
        let newCount = 0;
        
        if (complaintsSnap.empty) {
            listDiv.innerHTML = '<p class="text-gray-500 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´ÙƒØ§ÙˆÙ‰ Ø£Ùˆ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</p>';
        } else {
            listDiv.innerHTML = '';
            complaintsSnap.forEach(doc => {
                const comp = { id: doc.id, ...doc.data() };
                
                if (comp.status === 'Ø¬Ø¯ÙŠØ¯') newCount++;
                
                // Filter
                if (currentComplaintFilter === 'new' && comp.status !== 'Ø¬Ø¯ÙŠØ¯') return;
                if (currentComplaintFilter === 'Ø´ÙƒÙˆÙ‰' && comp.type !== 'Ø´ÙƒÙˆÙ‰') return;
                if (currentComplaintFilter === 'Ø§Ù‚ØªØ±Ø§Ø­' && comp.type !== 'Ø§Ù‚ØªØ±Ø§Ø­') return;
                
                const date = comp.submittedAt ? new Date(comp.submittedAt.toDate()).toLocaleDateString('ar-EG') : '';
                
                const typeColor = comp.type === 'Ø´ÙƒÙˆÙ‰' ? 'text-red-600' : 'text-blue-600';
                const statusBadge = comp.status === 'Ø¬Ø¯ÙŠØ¯' ? 
                    '<span class="bg-red-100 text-red-800 px-2 py-1 rounded text-xs font-bold">Ø¬Ø¯ÙŠØ¯ ğŸ”´</span>' :
                    comp.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' ?
                    '<span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs font-bold">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>' :
                    '<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-bold">ØªÙ… Ø§Ù„Ø±Ø¯ âœ“</span>';

                listDiv.innerHTML += `
                    <div class="border rounded-lg p-4">
                        <div class="flex items-center justify-between mb-2">
                            <p class="${typeColor} font-bold">${comp.type}</p>
                            ${statusBadge}
                        </div>
                        <p class="text-gray-800 mb-2">${comp.content}</p>
                        <div class="grid grid-cols-3 gap-2 text-sm text-gray-600 mb-2">
                            ${comp.name ? `<p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${comp.name}</p>` : ''}
                            ${comp.phone ? `<p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${comp.phone}</p>` : ''}
                            ${comp.email ? `<p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> ${comp.email}</p>` : ''}
                        </div>
                        ${comp.notes ? `<p class="text-sm text-gray-600 mb-2"><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${comp.notes}</p>` : ''}
                        ${comp.adminResponse ? `<div class="bg-blue-50 p-3 rounded mt-2"><p class="text-sm"><strong>Ø±Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:</strong> ${comp.adminResponse}</p></div>` : ''}
                        <div class="flex items-center justify-between mt-3">
                            <p class="text-xs text-gray-500">${date}</p>
                            ${comp.status !== 'ØªÙ… Ø§Ù„Ø±Ø¯' ? `<button onclick="openComplaintResponse('${comp.id}')" class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700">Ø§Ù„Ø±Ø¯</button>` : ''}
                        </div>
                    </div>
                `;
            });
        }
        
        document.getElementById('newComplaintsCount').textContent = newCount;
    } catch (error) {
        console.error('Error loading complaints:', error);
    }
}

function filterComplaints(filter) {
    currentComplaintFilter = filter;
    
    document.querySelectorAll('.complaint-filter-btn').forEach(btn => {
        btn.classList.remove('bg-blue-600', 'text-white', 'bg-gray-200');
        btn.classList.add('bg-gray-200');
    });
    event.target.classList.remove('bg-gray-200');
    event.target.classList.add('bg-blue-600', 'text-white');
    
    loadComplaints();
}

async function openComplaintResponse(id) {
    currentComplaintId = id;
    
    try {
        const doc = await firestore.collection('complaints').doc(id).get();
        const comp = doc.data();
        
        const content = document.getElementById('complaintContent');
        content.innerHTML = `
            <div class="bg-gray-50 p-4 rounded-lg space-y-2">
                <p><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${comp.type}</p>
                <p><strong>Ø§Ù„Ù…Ø­ØªÙˆÙ‰:</strong> ${comp.content}</p>
                ${comp.name ? `<p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${comp.name}</p>` : ''}
                ${comp.phone ? `<p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${comp.phone}</p>` : ''}
                ${comp.email ? `<p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> ${comp.email}</p>` : ''}
            </div>
        `;
        
        document.getElementById('complaintResponseText').value = '';
        document.getElementById('complaintResponseModal').classList.remove('hidden');
        
        // Mark as under review
        await firestore.collection('complaints').doc(id).update({
            status: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'
        });
    } catch (error) {
        console.error('Error opening complaint:', error);
    }
}

async function sendComplaintResponse() {
    const response = document.getElementById('complaintResponseText').value;
    
    if (!response.trim()) {
        alert('ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø±Ø¯');
        return;
    }

    try {
        await firestore.collection('complaints').doc(currentComplaintId).update({
            adminResponse: response,
            status: 'ØªÙ… Ø§Ù„Ø±Ø¯',
            respondedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯');
        closeComplaintResponseModal();
        loadComplaints();
    } catch (error) {
        console.error('Error sending response:', error);
        alert('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯');
    }
}

function closeComplaintResponseModal() {
    document.getElementById('complaintResponseModal').classList.add('hidden');
}

// Load data on page load (add to existing auth.onAuthStateChanged)
auth.onAuthStateChanged((user) => {
    if (user) {
        currentUser = user;
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('adminPanel').classList.remove('hidden');
        loadSettings();
        loadClinics();
        loadDoctorsNew(); // NEW
        loadAdminRequests(); // NEW
        loadComplaints(); // NEW
    } else {
        currentUser = null;
        document.getElementById('loginScreen').classList.remove('hidden');
        document.getElementById('adminPanel').classList.add('hidden');
    }
});

// Initial date set
document.getElementById('attendanceDate').valueAsDate = new Date();
</script>

    <style>
        body { font-family: 'Cairo', sans-serif; }
        .admin-bg { background: linear-gradient(135deg, #1e293b 0%, #334155 100%); }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1); }
        .tab-active { background: #3b82f6; color: white; }
        .tab-inactive { background: rgba(255, 255, 255, 0.1); color: #e2e8f0; }
        .arabic-number { font-family: 'Cairo', sans-serif; }
    </style>
</head>
<body class="admin-bg text-white min-h-screen">
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 text-gray-800">
            <div class="text-center mb-6">
                <i class="fas fa-lock text-4xl text-blue-600 mb-4"></i>
                <h2 class="text-2xl font-bold">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
            </div>
            <form id="loginForm">
                <div class="mb-4">
                    <label class="block text-gray-700 font-semibold mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="adminPassword" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                    <i class="fas fa-sign-in-alt ml-2"></i>Ø¯Ø®ÙˆÙ„
                </button>
            </form>
            <div id="loginError" class="mt-4 text-red-600 text-center hidden">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©</div>
        </div>
    </div>

    <!-- Main Admin Interface -->
    <div id="adminInterface" class="hidden">
        <!-- Header -->
        <header class="bg-black bg-opacity-30 p-4">
            <div class="container mx-auto flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-cogs text-3xl text-blue-400"></i>
                    <h1 class="text-2xl font-bold">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="currentTime" class="text-lg font-semibold"></span>
                    <button onclick="logout()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-sign-out-alt ml-2"></i>Ø®Ø±ÙˆØ¬
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="container mx-auto px-4 mt-6">
            <div class="flex flex-wrap gap-2">
                <button onclick="switchTab('settings')" class="tab-button tab-active px-6 py-3 rounded-lg font-semibold transition-all" data-tab="settings">
                    <i class="fas fa-cog ml-2"></i>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                </button>
                <button onclick="switchTab('clinics')" class="tab-button tab-inactive px-6 py-3 rounded-lg font-semibold transition-all" data-tab="clinics">
                    <i class="fas fa-hospital ml-2"></i>Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª
                </button>
                <button onclick="switchTab('audio')" class="tab-button tab-inactive px-6 py-3 rounded-lg font-semibold transition-all" data-tab="audio">
                    <i class="fas fa-volume-up ml-2"></i>Ø§Ù„ØµÙˆØªÙŠØ§Øª
                </button>
                <button onclick="switchTab('doctors')" class="tab-button tab-inactive px-6 py-3 rounded-lg font-semibold transition-all" data-tab="doctors">
                    <i class="fas fa-user-md ml-2"></i>Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡
                </button>
                <button onclick="switchTab('appointments')" class="tab-button tab-inactive px-6 py-3 rounded-lg font-semibold transition-all" data-tab="appointments">
                    <i class="fas fa-calendar ml-2"></i>Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
                </button>
                <button onclick="switchTab('notifications')" class="tab-button tab-inactive px-6 py-3 rounded-lg font-semibold transition-all" data-tab="notifications">
                    <i class="fas fa-bell ml-2"></i>Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
                </button>
                <button onclick="switchTab('emergency')" class="tab-button tab-inactive px-6 py-3 rounded-lg font-semibold transition-all" data-tab="emergency">
                    <i class="fas fa-exclamation-triangle ml-2"></i>Ø§Ù„Ø·ÙˆØ§Ø±Ø¦
                </button>
            </div>
        </nav>

        <!-- Tab Content -->
        <main class="container mx-auto px-4 mt-8">
            <!-- Settings Tab -->
            <div id="settings-tab" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Basic Settings -->
                    <div class="glass-effect rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-info-circle text-blue-400 ml-2"></i>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ²</label>
                                <input type="text" id="centerName" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg focus:outline-none focus:border-blue-400" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø·Ø¨ÙŠ">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">ÙƒÙ„Ù…Ø© Ø³Ø± ØµÙØ­Ø© Ø§Ù„Ø¹Ø±Ø¶</label>
                                <input type="password" id="displayPassword" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg focus:outline-none focus:border-blue-400" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± ØµÙØ­Ø© Ø§Ù„Ø¹Ø±Ø¶">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Ù…Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ (Ø«ÙˆØ§Ù†ÙŠ)</label>
                                <input type="number" id="alertDuration" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg focus:outline-none focus:border-blue-400" placeholder="5">
                            </div>
                        </div>
                    </div>

                    <!-- Display Settings -->
                    <div class="glass-effect rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-desktop text-green-400 ml-2"></i>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø±Ø¶
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold mb-2">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø®Ø¨Ø§Ø±ÙŠ</label>
                                <textarea id="newsTicker" rows="3" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg focus:outline-none focus:border-blue-400" placeholder="Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…Ø±ÙƒØ²Ù†Ø§ Ø§Ù„Ø·Ø¨ÙŠ..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Ø³Ø±Ø¹Ø© Ø§Ù„Ø´Ø±ÙŠØ· (Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©)</label>
                                <input type="number" id="tickerSpeed" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg focus:outline-none focus:border-blue-400" placeholder="50">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø§Ø´Ø§Øª</label>
                                <select id="screenCount" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg focus:outline-none focus:border-blue-400">
                                    <option value="1">Ø´Ø§Ø´Ø© ÙˆØ§Ø­Ø¯Ø©</option>
                                    <option value="2">Ø´Ø§Ø´ØªØ§Ù†</option>
                                    <option value="3">Ø«Ù„Ø§Ø« Ø´Ø§Ø´Ø§Øª</option>
                                    <option value="4">Ø£Ø±Ø¨Ø¹ Ø´Ø§Ø´Ø§Øª</option>
                                    <option value="5">Ø®Ù…Ø³ Ø´Ø§Ø´Ø§Øª</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Audio Settings -->
                <div class="glass-effect rounded-xl p-6 mt-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-volume-up text-purple-400 ml-2"></i>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold mb-2">Ù…Ø³Ø§Ø± Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ø¯Ø§Ø¡ (GitHub)</label>
                            <input type="text" id="audioPath" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg focus:outline-none focus:border-blue-400" placeholder="https://raw.githubusercontent.com/user/repo/main/audio/">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Ù…Ø³Ø§Ø± Ù…Ù„ÙØ§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (GitHub)</label>
                            <input type="text" id="videoPath" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg focus:outline-none focus:border-blue-400" placeholder="https://raw.githubusercontent.com/user/repo/main/media/">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© (GitHub)</label>
                            <input type="text" id="instantPath" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg focus:outline-none focus:border-blue-400" placeholder="https://raw.githubusercontent.com/user/repo/main/instant/">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Ø³Ø±Ø¹Ø© Ù†Ø·Ù‚ Ø§Ù„Ù†Ø¯Ø§Ø¡</label>
                            <select id="speechSpeed" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg focus:outline-none focus:border-blue-400">
                                <option value="0.5">Ø¨Ø·ÙŠØ¦Ø© Ø¬Ø¯Ø§Ù‹</option>
                                <option value="0.8">Ø¨Ø·ÙŠØ¦Ø©</option>
                                <option value="1" selected>Ø·Ø¨ÙŠØ¹ÙŠØ©</option>
                                <option value="1.2">Ø³Ø±ÙŠØ¹Ø©</option>
                                <option value="1.5">Ø³Ø±ÙŠØ¹Ø© Ø¬Ø¯Ø§Ù‹</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="flex justify-center mt-6">
                    <button onclick="saveSettings()" class="bg-blue-600 hover:bg-blue-700 px-8 py-3 rounded-lg font-semibold transition-colors">
                        <i class="fas fa-save ml-2"></i>Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    </button>
                </div>
            </div>

            <!-- Clinics Tab -->
            <div id="clinics-tab" class="tab-content hidden">
                <div class="glass-effect rounded-xl p-6 mb-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-plus-circle text-green-400 ml-2"></i>Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠØ§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <input type="text" id="newClinicName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©" class="p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg focus:outline-none focus:border-blue-400">
                        <input type="number" id="newClinicNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©" class="p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg focus:outline-none focus:border-blue-400">
                        <select id="newClinicScreen" class="p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg focus:outline-none focus:border-blue-400">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø§Ø´Ø©</option>
                            <option value="1">Ø§Ù„Ø´Ø§Ø´Ø© 1</option>
                            <option value="2">Ø§Ù„Ø´Ø§Ø´Ø© 2</option>
                            <option value="3">Ø§Ù„Ø´Ø§Ø´Ø© 3</option>
                            <option value="4">Ø§Ù„Ø´Ø§Ø´Ø© 4</option>
                            <option value="5">Ø§Ù„Ø´Ø§Ø´Ø© 5</option>
                        </select>
                        <input type="password" id="newClinicPassword" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„ØªØ­ÙƒÙ…" class="p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg focus:outline-none focus:border-blue-400">
                        <button onclick="addClinic()" class="bg-green-600 hover:bg-green-700 p-3 rounded-lg font-semibold transition-colors">
                            <i class="fas fa-plus ml-2"></i>Ø¥Ø¶Ø§ÙØ©
                        </button>
                    </div>
                </div>

                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-list text-blue-400 ml-2"></i>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª
                    </h3>
                    <div id="clinicsList" class="space-y-4">
                        <!-- Clinics will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Audio Tab -->
            <div id="audio-tab" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Record Audio -->
                    <div class="glass-effect rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-microphone text-red-400 ml-2"></i>ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold mb-2">Ø§Ù„Ù…Ø¯Ø© (10 Ø«ÙˆØ§Ù†ÙŠ ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰)</label>
                                <input type="number" id="recordDuration" max="10" min="1" value="5" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg">
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="startRecording()" id="recordBtn" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition-colors">
                                    <i class="fas fa-record-vinyl ml-2"></i>ØªØ³Ø¬ÙŠÙ„
                                </button>
                                <button onclick="playRecording()" id="playBtn" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors" disabled>
                                    <i class="fas fa-play ml-2"></i>ØªØ´ØºÙŠÙ„
                                </button>
                                <button onclick="broadcastRecording()" id="broadcastBtn" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition-colors" disabled>
                                    <i class="fas fa-broadcast-tower ml-2"></i>Ø¥Ø°Ø§Ø¹Ø©
                                </button>
                            </div>
                            <div id="recordingStatus" class="text-sm text-gray-300"></div>
                        </div>
                    </div>

                    <!-- Instant Audio -->
                    <div class="glass-effect rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-bolt text-yellow-400 ml-2"></i>Ø§Ù„ØµÙˆØªÙŠØ§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold mb-2">Ø§Ø®ØªØ± Ù…Ù„Ù ØµÙˆØªÙŠ</label>
                                <select id="instantAudioSelect" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg">
                                    <option value="">Ø§Ø®ØªØ± Ù…Ù„Ù...</option>
                                    <option value="instant1.mp3">Ø§Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ø§Ù„Ù…Ø±ÙƒØ²</option>
                                    <option value="instant2.mp3">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                                    <option value="instant3.mp3">Ø´ÙƒØ±Ø§Ù‹ Ù„ØµØ¨Ø±ÙƒÙ…</option>
                                </select>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="playInstantAudio()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors">
                                    <i class="fas fa-play ml-2"></i>ØªØ´ØºÙŠÙ„
                                </button>
                                <button onclick="broadcastInstantAudio()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition-colors">
                                    <i class="fas fa-broadcast-tower ml-2"></i>Ø¥Ø°Ø§Ø¹Ø©
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Audio Queue -->
                <div class="glass-effect rounded-xl p-6 mt-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-list-ol text-purple-400 ml-2"></i>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØµÙˆØªÙŠØ©
                    </h3>
                    <div id="audioQueue" class="space-y-2">
                        <!-- Audio queue items will be displayed here -->
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button onclick="clearAudioQueue()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-trash ml-2"></i>Ù…Ø³Ø­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                        </button>
                        <button onclick="processAudioQueue()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-play ml-2"></i>ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙ„
                        </button>
                    </div>
                </div>
            </div>

            <!-- Doctors Tab -->
            <div id="doctors-tab" class="tab-content hidden">
                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-user-plus text-green-400 ml-2"></i>Ø¥Ø¶Ø§ÙØ© Ø·Ø¨ÙŠØ¨ Ø¬Ø¯ÙŠØ¯
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <input type="text" id="doctorName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨" class="p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg">
                        <input type="text" id="doctorPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†" class="p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg">
                        <input type="text" id="doctorNationalId" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ" class="p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg">
                        <input type="text" id="doctorSpecialty" placeholder="Ø§Ù„ØªØ®ØµØµ" class="p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg">
                        <select id="doctorClinic" class="p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</option>
                        </select>
                        <input type="email" id="doctorEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg">
                        <button onclick="addDoctor()" class="bg-green-600 hover:bg-green-700 p-3 rounded-lg font-semibold transition-colors">
                            <i class="fas fa-plus ml-2"></i>Ø¥Ø¶Ø§ÙØ©
                        </button>
                    </div>
                </div>

                <div class="glass-effect rounded-xl p-6 mt-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-users text-blue-400 ml-2"></i>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡
                    </h3>
                    <div id="doctorsList" class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="border-b border-white border-opacity-30">
                                    <th class="text-right p-2">Ø§Ù„Ø§Ø³Ù…</th>
                                    <th class="text-right p-2">Ø§Ù„ØªØ®ØµØµ</th>
                                    <th class="text-right p-2">Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</th>
                                    <th class="text-right p-2">Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†</th>
                                    <th class="text-right p-2">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th class="text-right p-2">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="doctorsTableBody">
                                <!-- Doctors will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

<div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-gray-800">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ ÙˆØ§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ†</h2>
        <button onclick="showAddDoctorNew()" class="bg-teal-600 text-white px-6 py-2 rounded-lg hover:bg-teal-700 font-bold">
            â• Ø¥Ø¶Ø§ÙØ© Ø·Ø¨ÙŠØ¨ Ø¬Ø¯ÙŠØ¯
        </button>
    </div>
    
    <!-- Search and Filter -->
    <div class="flex gap-4 mb-4">
        <input type="text" id="searchDoctors" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ" 
               class="flex-1 px-4 py-2 border border-gray-300 rounded-lg" onkeyup="searchDoctors()">
        <select id="filterSpecialty" class="px-4 py-2 border border-gray-300 rounded-lg" onchange="filterDoctors()">
            <option value="">ÙƒÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª</option>
        </select>
        <select id="filterStatus" class="px-4 py-2 border border-gray-300 rounded-lg" onchange="filterDoctors()">
            <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
            <option value="Ù†Ø´Ø·">Ù†Ø´Ø·</option>
            <option value="Ù…Ø¹Ù„Ù‚">Ù…Ø¹Ù„Ù‚</option>
            <option value="Ù…Ø¬Ø§Ø²Ø©">ÙÙŠ Ø¥Ø¬Ø§Ø²Ø©</option>
        </select>
    </div>

    <div id="doctorsListNew" class="space-y-3"></div>
</div>

<!-- Attendance Management -->
<div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <h2 class="text-xl font-bold text-gray-800 mb-4">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</h2>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div>
            <label class="block text-gray-700 font-bold mb-2">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø¨ÙŠØ¨:</label>
            <select id="attendanceDoctor" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø¨ÙŠØ¨</option>
            </select>
        </div>
        <div>
            <label class="block text-gray-700 font-bold mb-2">Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
            <input type="date" id="attendanceDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
        <div>
            <label class="block text-gray-700 font-bold mb-2">ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±:</label>
            <input type="time" id="checkInTime" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
        </div>
        <div>
            <label class="block text-gray-700 font-bold mb-2">ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù:</label>
            <input type="time" id="checkOutTime" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
        </div>
        <div>
            <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ø­Ø§Ù„Ø©:</label>
            <select id="attendanceStatus" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                <option value="Ø­Ø§Ø¶Ø±">Ø­Ø§Ø¶Ø±</option>
                <option value="ØºØ§Ø¦Ø¨">ØºØ§Ø¦Ø¨</option>
                <option value="Ø¥Ø¬Ø§Ø²Ø©">Ø¥Ø¬Ø§Ø²Ø©</option>
                <option value="Ù…Ø£Ù…ÙˆØ±ÙŠØ©">Ù…Ø£Ù…ÙˆØ±ÙŠØ©</option>
            </select>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div>
            <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ø´ÙŠÙØª:</label>
            <select id="attendanceShift" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                <option value="ØµØ¨Ø§Ø­ÙŠ">ØµØ¨Ø§Ø­ÙŠ</option>
                <option value="Ù…Ø³Ø§Ø¦ÙŠ">Ù…Ø³Ø§Ø¦ÙŠ</option>
            </select>
        </div>
        <div>
            <label class="block text-gray-700 font-bold mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
            <input type="text" id="attendanceNotes" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©">
        </div>
    </div>

    <button onclick="saveAttendance()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 font-bold">
        ğŸ’¾ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±
    </button>

    <div class="mt-6">
        <h3 class="text-lg font-bold text-gray-800 mb-3">Ø±ÙØ¹ Ù…Ù„Ù Excel Ù„Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ</h3>
        <div class="flex gap-4">
            <input type="file" id="excelFile" accept=".xlsx,.xls,.csv" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg">
            <button onclick="uploadAttendanceExcel()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 font-bold">
                ğŸ“¤ Ø±ÙØ¹ Ù…Ù„Ù
            </button>
        </div>
        <p class="text-sm text-gray-600 mt-2">* Ø§Ù„Ù…Ù„Ù ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰: Ø±Ù‚Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨ØŒ Ø§Ù„ØªØ§Ø±ÙŠØ®ØŒ Ø§Ù„Ø­Ø¶ÙˆØ±ØŒ Ø§Ù„Ø§Ù†ØµØ±Ø§ÙØŒ Ø§Ù„Ø­Ø§Ù„Ø©ØŒ Ø§Ù„Ø´ÙŠÙØª</p>
    </div>
</div>

<!-- Requests Management -->
<div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-gray-800">Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ†</h2>
        <div class="flex gap-2">
            <button onclick="filterAdminRequests('all')" class="admin-filter-btn bg-gray-200 px-4 py-2 rounded-lg font-bold">
                Ø§Ù„ÙƒÙ„ <span id="countAll">0</span>
            </button>
            <button onclick="filterAdminRequests('pending')" class="admin-filter-btn px-4 py-2 rounded-lg font-bold">
                Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© <span id="countPending" class="bg-yellow-500 text-white px-2 py-1 rounded-full text-xs ml-1">0</span>
            </button>
            <button onclick="filterAdminRequests('approved')" class="admin-filter-btn px-4 py-2 rounded-lg font-bold">
                Ù…ÙˆØ§ÙÙ‚ <span id="countApproved">0</span>
            </button>
            <button onclick="filterAdminRequests('rejected')" class="admin-filter-btn px-4 py-2 rounded-lg font-bold">
                Ù…Ø±ÙÙˆØ¶ <span id="countRejected">0</span>
            </button>
        </div>
    </div>

    <div id="adminRequestsList" class="space-y-4"></div>
</div>

<!-- Complaints and Suggestions -->
<div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-gray-800">Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</h2>
        <div class="flex gap-2">
            <button onclick="filterComplaints('all')" class="complaint-filter-btn bg-gray-200 px-4 py-2 rounded-lg font-bold">Ø§Ù„ÙƒÙ„</button>
            <button onclick="filterComplaints('Ø´ÙƒÙˆÙ‰')" class="complaint-filter-btn px-4 py-2 rounded-lg font-bold">Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</button>
            <button onclick="filterComplaints('Ø§Ù‚ØªØ±Ø§Ø­')" class="complaint-filter-btn px-4 py-2 rounded-lg font-bold">Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</button>
            <button onclick="filterComplaints('new')" class="complaint-filter-btn px-4 py-2 rounded-lg font-bold">
                Ø¬Ø¯ÙŠØ¯ <span id="newComplaintsCount" class="bg-red-500 text-white px-2 py-1 rounded-full text-xs ml-1">0</span>
            </button>
        </div>
    </div>

    <div id="complaintsList" class="space-y-4"></div>
</div>

<!-- Add/Edit Doctor Modal -->
<div id="doctorModalNew" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto">
    <div class="bg-white rounded-lg p-8 max-w-3xl w-full mx-4 my-8">
        <h3 class="text-2xl font-bold text-gray-800 mb-4" id="doctorModalTitleNew">Ø¥Ø¶Ø§ÙØ© Ø·Ø¨ÙŠØ¨ Ø¬Ø¯ÙŠØ¯</h3>
        <div class="space-y-4">
            <input type="hidden" id="editDoctorIdNew">
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 font-bold mb-2">Ø±Ù‚Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ:</label>
                    <input type="text" id="doctorEmployeeNumber" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ø§Ø³Ù…:</label>
                    <input type="text" id="doctorNameNew" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 font-bold mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
                    <input type="tel" id="doctorPhoneNew" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ:</label>
                    <input type="text" id="doctorNationalId" class="w-full px-4 py-2 border border-gray-300 rounded-lg" maxlength="14">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 font-bold mb-2">Ø§Ù„ØªØ®ØµØµ:</label>
                    <input type="text" id="doctorSpecialtyNew" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©:</label>
                    <select id="doctorClinicNew" class="w-full px-4 py-2 border border-gray-300 rounded-lg"></select>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 font-bold mb-2">Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù…Ù„:</label>
                    <select id="doctorWorkStatus" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        <option value="Ù†Ø´Ø·">Ù†Ø´Ø·</option>
                        <option value="Ù…Ø¹Ù„Ù‚">Ù…Ø¹Ù„Ù‚</option>
                        <option value="Ù…Ø¬Ø§Ø²Ø©">ÙÙŠ Ø¥Ø¬Ø§Ø²Ø©</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ø´ÙŠÙØª:</label>
                    <select id="doctorShift" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        <option value="ØµØ¨Ø§Ø­ÙŠ">ØµØ¨Ø§Ø­ÙŠ</option>
                        <option value="Ù…Ø³Ø§Ø¦ÙŠ">Ù…Ø³Ø§Ø¦ÙŠ</option>
                    </select>
                </div>
            </div>

            <div>
                <label class="block text-gray-700 font-bold mb-2">Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„:</label>
                <div class="grid grid-cols-7 gap-2">
                    <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" class="doctor-day-checkbox-new" value="Ø§Ù„Ø£Ø­Ø¯">
                        <span class="text-xs">Ø§Ù„Ø£Ø­Ø¯</span>
                    </label>
                    <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" class="doctor-day-checkbox-new" value="Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†">
                        <span class="text-xs">Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†</span>
                    </label>
                    <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" class="doctor-day-checkbox-new" value="Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡">
                        <span class="text-xs">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</span>
                    </label>
                    <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" class="doctor-day-checkbox-new" value="Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡">
                        <span class="text-xs">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</span>
                    </label>
                    <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" class="doctor-day-checkbox-new" value="Ø§Ù„Ø®Ù…ÙŠØ³">
                        <span class="text-xs">Ø§Ù„Ø®Ù…ÙŠØ³</span>
                    </label>
                    <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" class="doctor-day-checkbox-new" value="Ø§Ù„Ø¬Ù…Ø¹Ø©">
                        <span class="text-xs">Ø§Ù„Ø¬Ù…Ø¹Ø©</span>
                    </label>
                    <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" class="doctor-day-checkbox-new" value="Ø§Ù„Ø³Ø¨Øª">
                        <span class="text-xs">Ø§Ù„Ø³Ø¨Øª</span>
                    </label>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 font-bold mb-2">Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø§Ø¹ØªÙŠØ§Ø¯ÙŠØ©:</label>
                    <input type="number" id="doctorRegularLeave" class="w-full px-4 py-2 border border-gray-300 rounded-lg" value="21">
                </div>
                <div>
                    <label class="block text-gray-700 font-bold mb-2">Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø¹Ø§Ø±Ø¶Ø©:</label>
                    <input type="number" id="doctorCasualLeave" class="w-full px-4 py-2 border border-gray-300 rounded-lg" value="7">
                </div>
            </div>

            <div>
                <label class="block text-gray-700 font-bold mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                <input type="email" id="doctorEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="doctor@example.com">
            </div>

            <div id="passwordSection">
                <label class="block text-gray-700 font-bold mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± (Ù„Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…):</label>
                <input type="password" id="doctorPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± Ù‚ÙˆÙŠØ©">
                <p class="text-xs text-gray-500 mt-1">* Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù„Ù„Ø·Ø¨ÙŠØ¨ ÙÙŠ Firebase Authentication</p>
            </div>

            <div>
                <label class="block text-gray-700 font-bold mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
                <textarea id="doctorNotesNew" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg"></textarea>
            </div>

            <div class="flex gap-4">
                <button onclick="saveDoctorNew()" class="flex-1 bg-teal-600 text-white px-6 py-2 rounded-lg hover:bg-teal-700 font-bold">Ø­ÙØ¸</button>
                <button onclick="closeDoctorModalNew()" class="flex-1 bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 font-bold">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>
</div>

<!-- Request Review Modal -->
<div id="requestReviewModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨</h3>
        <div id="requestReviewContent" class="space-y-4 mb-6"></div>
        
        <div class="space-y-4">
            <div>
                <label class="block text-gray-700 font-bold mb-2">Ø±Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:</label>
                <textarea id="adminResponseText" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Ø§ÙƒØªØ¨ Ø±Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù‡Ù†Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
            </div>

            <div class="flex gap-4">
                <button onclick="reviewRequest('approve')" class="flex-1 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 font-bold">
                    âœ… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨
                </button>
                <button onclick="reviewRequest('reject')" class="flex-1 bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 font-bold">
                    âŒ Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨
                </button>
                <button onclick="closeRequestReviewModal()" class="flex-1 bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 font-bold">
                    Ø¥Ù„ØºØ§Ø¡
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Complaint Response Modal -->
<div id="complaintResponseModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´ÙƒÙˆÙ‰/Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­</h3>
        <div id="complaintContent" class="space-y-4 mb-6"></div>
        
        <div class="space-y-4">
            <div>
                <label class="block text-gray-700 font-bold mb-2">Ø±Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:</label>
                <textarea id="complaintResponseText" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø¯ Ù‡Ù†Ø§"></textarea>
            </div>

            <div class="flex gap-4">
                <button onclick="sendComplaintResponse()" class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-bold">
                    ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯
                </button>
                <button onclick="closeComplaintResponseModal()" class="flex-1 bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 font-bold">
                    Ø¥Ù„ØºØ§Ø¡
                </button>
            </div>
        </div>
    </div>
</div>
            
            <!-- Appointments Tab -->
            <div id="appointments-tab" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Appointment Settings -->
                    <div class="glass-effect rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-cog text-blue-400 ml-2"></i>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø¬Ø²
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ù„ÙƒÙ„ Ø¹ÙŠØ§Ø¯Ø© (Ø´ÙØª ØµØ¨Ø§Ø­ÙŠ)</label>
                                <input type="number" id="morningSlots" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg" placeholder="20">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ù„ÙƒÙ„ Ø¹ÙŠØ§Ø¯Ø© (Ø´ÙØª Ù…Ø³Ø§Ø¦ÙŠ)</label>
                                <input type="number" id="eveningSlots" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg" placeholder="15">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">ÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø´ÙØª Ø§Ù„ØµØ¨Ø§Ø­ÙŠ</label>
                                <input type="time" id="morningStart" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg" value="08:00">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">ÙˆÙ‚Øª Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´ÙØª Ø§Ù„ØµØ¨Ø§Ø­ÙŠ</label>
                                <input type="time" id="morningEnd" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg" value="14:00">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">ÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø´ÙØª Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠ</label>
                                <input type="time" id="eveningStart" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg" value="14:00">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">ÙˆÙ‚Øª Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´ÙØª Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠ</label>
                                <input type="time" id="eveningEnd" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg" value="20:00">
                            </div>
                        </div>
                    </div>

                    <!-- Appointment Requests -->
                    <div class="glass-effect rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-calendar-check text-green-400 ml-2"></i>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø¬Ø²
                        </h3>
                        <div id="appointmentRequests" class="space-y-3 max-h-96 overflow-y-auto">
                            <!-- Appointment requests will be loaded here -->
                        </div>
                    </div>
                </div>

                <div class="flex justify-center mt-6">
                    <button onclick="saveAppointmentSettings()" class="bg-blue-600 hover:bg-blue-700 px-8 py-3 rounded-lg font-semibold transition-colors">
                        <i class="fas fa-save ml-2"></i>Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    </button>
                </div>
            </div>

            <!-- Notifications Tab -->
            <div id="notifications-tab" class="tab-content hidden">
                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-bullhorn text-yellow-400 ml-2"></i>Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡
                    </h3>
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold mb-2">Ù†ÙˆØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</label>
                                <select id="notificationType" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg">
                                    <option value="general">ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø§Ù…</option>
                                    <option value="client">Ù†Ø¯Ø§Ø¡ Ø¹Ù…ÙŠÙ„</option>
                                    <option value="emergency">Ø­Ø§Ù„Ø© Ø·Ø§Ø±Ø¦Ø©</option>
                                    <option value="doctor">ØªÙ†Ø¨ÙŠÙ‡ Ø·Ø¨ÙŠØ¨</option>
                                </select>
                            </div>
                            <div id="clientNumberDiv" class="hidden">
                                <label class="block text-sm font-semibold mb-2">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                                <input type="number" id="clientNumber" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</label>
                                <select id="notificationClinic" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg">
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Ù†Øµ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</label>
                            <textarea id="notificationText" rows="3" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg" placeholder="Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡..."></textarea>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="sendNotification()" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg transition-colors">
                                <i class="fas fa-paper-plane ml-2"></i>Ø¥Ø±Ø³Ø§Ù„
                            </button>
                            <button onclick="sendToAllControls()" class="bg-green-600 hover:bg-green-700 px-6 py-2 rounded-lg transition-colors">
                                <i class="fas fa-broadcast-tower ml-2"></i>Ø¥Ø±Ø³Ø§Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ù„ÙˆØ­Ø§Øª Ø§Ù„ØªØ­ÙƒÙ…
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Recent Notifications -->
                <div class="glass-effect rounded-xl p-6 mt-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-history text-purple-400 ml-2"></i>Ø£Ø­Ø¯Ø« Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
                    </h3>
                    <div id="recentNotifications" class="space-y-2 max-h-96 overflow-y-auto">
                        <!-- Recent notifications will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Emergency Tab -->
            <div id="emergency-tab" class="tab-content hidden">
                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center text-red-400">
                        <i class="fas fa-exclamation-triangle ml-2"></i>Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø©
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold mb-2">Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</label>
                                <select id="emergencyClinic" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg">
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                <input type="number" id="emergencyClientNumber" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ù„ØªØ®Ø·ÙŠ">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø§Ø±Ø¦Ø©</label>
                                <textarea id="emergencyReason" rows="3" class="w-full p-3 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg" placeholder="ÙˆØµÙ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø§Ø±Ø¦Ø©..."></textarea>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <h4 class="font-semibold text-lg">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:</h4>
                            <button onclick="activateEmergency()" class="w-full bg-red-600 hover:bg-red-700 p-3 rounded-lg font-semibold transition-colors">
                                <i class="fas fa-exclamation-circle ml-2"></i>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø§Ø±Ø¦Ø©
                            </button>
                            <button onclick="skipQueue()" class="w-full bg-orange-600 hover:bg-orange-700 p-3 rounded-lg font-semibold transition-colors">
                                <i class="fas fa-forward ml-2"></i>ØªØ®Ø·ÙŠ Ø§Ù„Ø·Ø§Ø¨ÙˆØ±
                            </button>
                            <button onclick="clearAllQueues()" class="w-full bg-yellow-600 hover:bg-yellow-700 p-3 rounded-lg font-semibold transition-colors">
                                <i class="fas fa-broom ml-2"></i>ØªØµÙÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª
                            </button>
                            <button onclick="resetDaily()" class="w-full bg-blue-600 hover:bg-blue-700 p-3 rounded-lg font-semibold transition-colors">
                                <i class="fas fa-redo ml-2"></i>ØªØµÙÙŠØ± ÙŠÙˆÙ…ÙŠ (Ø§Ù„Ø³Ø§Ø¹Ø© 6 Øµ)
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Emergency Log -->
                <div class="glass-effect rounded-xl p-6 mt-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-clipboard-list text-orange-400 ml-2"></i>Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø©
                    </h3>
                    <div id="emergencyLog" class="space-y-2 max-h-96 overflow-y-auto">
                        <!-- Emergency log will be loaded here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/firebase-config.js"></script>
    <script src="js/admin.js"></script>
</body>
</html>
